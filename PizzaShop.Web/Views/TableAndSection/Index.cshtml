@inject IHttpContextAccessor Accessor;
@using Newtonsoft.Json;
@using PizzaShop.ViewModels;
@{
    ViewData["Title"] = "Table And Section";
    var permission = JsonConvert.DeserializeObject<List<ManageRolePermissioinViewModel>>(Accessor.HttpContext.Session.GetString("permission"));
}

@model PizzaShop.DataAccess.ViewModels.TableAndSectionViewModel;

<section>
    <div class="row">
        <h2 class="textBlue col-2">Sections/Tables</h2>
    </div>

    <section class="p-md-3">
        <div class="row mx-0 table-section">
            <aside class="col-12 col-md-3 h-100" style="background-color: #f5f5f5" id="tableList">
                <!-- Section header -->
                <div class="d-flex flex-wrap justify-content-between align-items-center p-2">
                    <h5 class="textBlue">Sections</h5>
                    <button class="btn btn-outline-primary  d-@(permission[3].Canaddedit == false ? "none" : "")" id="addSectionBtn">
                        <i class="fa-solid fa-plus"></i>
                    </button>
                </div>
                <!-- Section list -->
                <div class="section-list" id="section-list">
                    @Html.Partial("_ListSections", Model)
                </div>
            </aside>
            <!-- Tables -->
            <div class="col-12 col-md-9 border-start border-primary bg-light">
                <div>
                    <!-- Tables header -->
                    <h5 class="p-2 mb-0 textBlue">Tables</h5>
                    <div class="d-md-flex justify-content-center justify-content-md-end align-items-center my-3">
                        <div class="d-flex justify-content-center align-items-center">
                            <div class="form-input-div my-1 me-3">
                                <input type="text" placeholder="Search" class="form-control p-2" name="search"
                                    id="searchTables" />
                                <span class="form-input-icon"><i class="fa-solid fa-search" id="eye-icon"
                                        style="color: gray"></i>
                                </span>
                            </div>
                            <div>
                                <button class="btn btn-outline-secondary me-3 d-@(permission[3].Candelete == false ? "none" : "")" id="deleteMultipleTablesBtn">
                                    <i class="fa-solid fa-trash"></i>
                                </button>
                            </div>
                        </div>

                        <div class="d-flex justify-content-center align-items-center mt-2 mt-md-0">
                            <button class="btn btn-primary me-3 d-@(permission[3].Canaddedit == false ? "none" : "")" id="addTableBtn">
                                <i class="fa-solid fa-plus me-2"></i>New Table
                            </button>
                        </div>
                    </div>

                    <!-- Table List -->
                    <div id="table-list">
                        @Html.Partial("_ListTables", Model)
                    </div>
                </div>
            </div>
        </div>
    </section>
</section>
<script>
    var selectedIds = [];

    $("#addTableBtn").click(function () {
        $.get('@Url.Action("AddEditTable", "TableAndSection")', function (data) {
            $("#addEditTableContainer").html(data);
            $("#SectionId").val(sectionId);
            $("#addEditTableModal").modal('show');
        })
    })

    $("#deleteMultipleTablesBtn").click(function () {
        if (selectedIds.length > 0)
            $("#deleteMultipleTableModal").modal('show');
        else
            toastr.warning("Please select at least one table");
    })

    $(document).on('change', '.tableCheckbox', function () {
        const tableId = $(this).val();

        if ($(this).is(':checked') && !selectedIds.includes(tableId)) {
            selectedIds.push(tableId);
        } else {
            selectedIds = selectedIds.filter(id => id !== tableId);
            $('.selectAllTables').prop('checked', false);
        }
        if ($('.tableCheckbox:checked').length === $('.tableCheckbox').length) {
            $('.selectAllTables').prop('checked', true);
        }
    });

    $("#addSectionBtn").click(function () {
        $.get('@Url.Action("AddSection", "TableAndSection")', function (data) {
            $("#addSectionContainer").html(data);
            $("#addSectionModal").modal('show');
        })
    })

</script>

<script src="~/js/TableAndSection.js" asp-append-version="true"></script>